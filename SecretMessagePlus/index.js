(function(p,l,c,v,I,d,r,L,$){"use strict";let A="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";function y(e,n){let a="";for(let t=0;t<e.length;t++)a+=String.fromCharCode(e.charCodeAt(t)^n.charCodeAt(t%n.length));return a}function T(e){return`${y("secret",e).slice(0,3).padStart(3,"?")}`}function _(e){return`\`<${e.slice(0,2)}${"*".repeat(Math.max(e.length-2,0))}>\``}function C(e){return new RegExp(` \`<${e.slice(0,2)}${"\\*".repeat(Math.max(e.length-2,0))}>\`$`)}function U(e,n,a){const t=e.slice(0,n),s=e.slice(n);return`${t}${a}${s}`}function O(e,n){const a=e.slice(0,n),t=e.slice(n+1);return`${a}${t}`}function B(e,n){return e=Math.ceil(e),n=Math.floor(n),Math.floor(Math.random()*(n-e+1))+e}function o(){return A[B(0,A.length-1)]}function S(e){let n=c.storage.key,a=G(y(e,n)),t=Math.floor(a.length/3),s=T(n);return t==0?a=`${s}${a}`:[3,2,1].forEach(function(i){a=U(a,t*i-1,s[i-1])}),`${o()}${o()}${a}${o()}${o()}`}function w(e,n){let a=2;if(e.length<=9){if(e.slice(2,5)==n)return e.slice(5,-2)}else{let t=Math.floor((e.length-a*2-3)/3),s=`${e[t-1+(1-1)+a]}${e[t*2-1+(2-1)+a]}${e[t*3-1+(3-1)+a]}`;if(e=e.slice(2,-2),n==s)return[3,2,1].forEach(function(i){e=O(e,t*i-1+(i-1))}),e}return!1}function g(e){let n=c.storage.key,a=T(n),t=_(n),s=w(e,a);return s?`${y(P(s),n)} ${t}`:e}function P(e){return e.replaceAll("\u2004","\r").replaceAll("\u2001",`
`).replaceAll("\u2002","\v").replaceAll("\u2003","\f")}function G(e){return c.storage.shorten_text?e.replaceAll("\v","\u2002").replaceAll("\f","\u2003").replaceAll("\r","\u2004").replaceAll(`
`,"\u2001"):e}function D(e){return"type"in e&&"props"in e}const{FormRow:u,FormInput:F,FormSwitch:H,FormSection:b,FormDivider:M,FormRadioRow:k}=L.Forms,{ScrollView:x}=r.ReactNative;function R(e,n){$.useProxy(n);const a=r.NavigationNative.useNavigation();return r.React.createElement(x,null,e.map(function(t){if(D(t))return t;switch(t.type){case"switch":return r.React.createElement(u,{label:t.label,subLabel:t.description,trailing:r.React.createElement(H,{value:n[t.key]??t.default,onValueChange:function(s){return n[t.key]=s}})});case"radio":return r.React.createElement(b,{title:t.label},r.React.createElement(r.ReactNative.FlatList,{data:t.choices,ItemSeparatorComponent:M,renderItem:function(s){let{item:i}=s;return r.React.createElement(k,{label:i.label,subLabel:i.description,selected:n[t.key]===i.value,onPress:function(){n[t.key]=i.value}})}}));case"checklist":return r.React.createElement(b,{title:t.label},r.React.createElement(r.ReactNative.FlatList,{data:t.choices,ItemSeparatorComponent:M,renderItem:function(s){let{item:i}=s;return n[t.key]||(n[t.key]=[]),r.React.createElement(k,{label:i.label,subLabel:i.description,selected:n[t.key].includes(i.value),onPress:function(){n[t.key].includes(i.value)?n[t.key]=n[t.key].filter(function(j){return j!==i.value}):n[t.key]=[...n[t.key],i.value]}})}}));case"input":return r.React.createElement(F,{title:t.label,value:n[t.key]??t.default,onSubmitEditing:function(s){return n[t.key]=s.nativeEvent.text},placeholder:t.description,returnKeyType:"done",secureTextEntry:t.secure,multiline:t.lines>1,numberOfLines:t.lines||1});case"button":return r.React.createElement(u,{label:t.label,subLabel:t.description,onPress:function(){t.onclick()}});case"page":return r.React.createElement(u,{label:t.label,subLabel:t.description,trailing:r.React.createElement(u.Arrow,null),onPress:function(){return a.push("VendettaCustomPage",{title:t.label,render:function(){return R(t.components,n)}})}});case"title":return r.React.createElement(b,{title:t.label,description:t.description});default:return null}}))}const N=[{label:"Legacy",description:"The legacy encryption method used by SecretMessage (both Enmity and Vendetta), backwards compatible",value:"legacy"},{label:"RSA",description:"Uses a public key to encrypt messages and a private key to decrypt them",value:"rsa"},{label:"AES-128",description:"Military-grade encryption using 128-bit keys to encrypt and decrypt messages",value:"aes-128"}];var V=[{type:"title",label:"SecretMessagePlus",description:"A plugin to encrypt your messages in many ways"},{type:"switch",label:"Enable encryption",description:"Messages that you send will be encrypted in your selected method.",key:"enable_encryption"},{type:"radio",label:"Encryption Method",description:"Method used to encrypt messages",key:"encryption_method",choices:N},{type:"checklist",label:"Decryption methods",description:"Methods used to decrypt messages automatically",key:"decryption_methods",choices:N},{type:"page",label:"RSA",description:"Configuration for RSA encryption and decryption",components:[{type:"input",label:"Private key",description:"The private key to decrypt messages using RSA",key:"rsa_private",multiLine:!0,lines:4,protected:!0},{type:"input",label:"Public key",description:"The public key to encrypt messages using RSA",key:"rsa_public",multiLine:!0,lines:3},{type:"button",label:"Generate public key",decription:"Generate a public key to encrypt messages that can be decrypted using your private key",onclick:function(){}}]},{type:"input",label:"AES Key",description:"The key to encrypt and decrypt messages using AES",key:"aes_key",protected:!0}],E;(function(e){e[e.SUB_COMMAND=1]="SUB_COMMAND",e[e.SUB_COMMAND_GROUP=2]="SUB_COMMAND_GROUP",e[e.STRING=3]="STRING",e[e.INTEGER=4]="INTEGER",e[e.BOOLEAN=5]="BOOLEAN",e[e.USER6=6]="USER6",e[e.CHANNEL=7]="CHANNEL",e[e.ROLE=8]="ROLE",e[e.MENTIONABLE=9]="MENTIONABLE",e[e.NUMBER=10]="NUMBER",e[e.ATTACHMENT=11]="ATTACHMENT"})(E||(E={}));var f;(function(e){e[e.BUILT_IN=0]="BUILT_IN",e[e.BUILT_IN_TEXT=1]="BUILT_IN_TEXT",e[e.BUILT_IN_INTEGRATION=2]="BUILT_IN_INTEGRATION",e[e.BOT=3]="BOT",e[e.PLACEHOLDER=4]="PLACEHOLDER"})(f||(f={}));var h;(function(e){e[e.CHAT=1]="CHAT",e[e.USER=2]="USER",e[e.MESSAGE=3]="MESSAGE"})(h||(h={}));const m=v.findByProps("sendMessage","receiveMessage"),X=[l.patcher.before("dispatch",l.metro.common.FluxDispatcher,function(e){let[n]=e;switch(n.type){case"MESSAGE_CREATE":n.message.content=g(n.message.content);break;case"MESSAGE_UPDATE":n.message.content=g(n.message.content);break;case"LOAD_MESSAGES_SUCCESS":n.messages.forEach(function(a){a.content=g(a.content)});break}c.storage.debug&&l.logger.info(n)}),l.patcher.before("sendMessage",m,function(e){let[,n]=e;c.storage.enable_encryption&&(n.content=S(n.content))}),l.patcher.before("editMessage",m,function(e){let[,n]=e;c.storage.enable_encryption&&(n.content=S(n.content))}),l.patcher.before("startEditMessage",m,function(e){let[,,n]=e;n=n.replace(C(c.storage.key),"")}),I.registerCommand({name:"togglesecretmessage",displayName:"togglesecretmessage",description:"Toggle SecretMessage",displayDescription:"Toggle SecretMessage",options:[{name:"enable",displayName:"enable",description:"Enable SecretMessage (If not specified, it will be toggled)",displayDescription:"Enable SecretMessage (If not specified, it will be toggled)",type:E.BOOLEAN,required:!1}],applicationId:"",inputType:f.BUILT_IN_TEXT,type:h.CHAT,execute:function(e,n){e[0].value?(c.storage.enable_encryption=!0,d.toasts.showToast("Encrypting messages enabled")):e[0].value===!1?(c.storage.enable_encryption=!1,d.toasts.showToast("Encrypting messages disabled")):(c.storage.enable_encryption=!c.storage.enable_encryption,d.toasts.showToast(`Encrypting messages ${c.storage.enable_encryption?"enabled":"disabled"}`))}})];function K(){c.storage.debug&&l.logger.info("Unloading SecretMessage"),X.forEach(function(e){return e()})}const q=function(){return R(V,c.storage)};return p.onUnload=K,p.settings=q,p})({},vendetta,vendetta.plugin,vendetta.metro,vendetta.commands,vendetta.ui,vendetta.metro.common,vendetta.ui.components,vendetta.storage);
