(function(i,l,a,M,r,m,p){"use strict";const{FormText:V,FormRow:f,FormInput:A,FormSwitch:g}=M.Forms,{ScrollView:S}=a.ReactNative;function C(){return m.useProxy(r.storage),a.React.createElement(S,null,a.React.createElement(A,{title:"Key",value:r.storage.key??"default",onSubmitEditing:function(e){return r.storage.key=e.nativeEvent.text},placeholder:"Secret key to encrypt messages",returnKeyType:"done",secureTextEntry:!0}),a.React.createElement(f,{label:"Auto shorten text",subLabel:"Shorten encrypted text by replacing specific char. Can be detected by AutoMod.",trailing:a.React.createElement(g,{value:r.storage.shorten_text??!0,onValueChange:function(e){return r.storage.shorten_text=e}})}),a.React.createElement(f,{label:"Enable encryption",subLabel:"Messages that you send will be encrypted.",trailing:a.React.createElement(g,{value:r.storage.enable_encryption??!1,onValueChange:function(e){return r.storage.enable_encryption=e}})}),a.React.createElement(f,{label:"Debug Mode",subLabel:"Log debug messages to console.",trailing:a.React.createElement(g,{value:r.storage.debug??!1,onValueChange:function(e){return r.storage.debug=e}})}))}let E="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";function h(e,t){let n="";for(let o=0;o<e.length;o++)n+=String.fromCharCode(e.charCodeAt(o)^t.charCodeAt(o%t.length));return n}function y(e){return`${h("secret",e).slice(0,3).padStart(3,"?")}`}function R(e){return`\`<${e.slice(0,2)}${"*".repeat(Math.max(e.length-2,0))}>\``}function v(e,t,n){const o=e.slice(0,t),c=e.slice(t);return`${o}${n}${c}`}function x(e,t){const n=e.slice(0,t),o=e.slice(t+1);return`${n}${o}`}function k(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function u(){return E[k(0,E.length-1)]}function $(e){let t=r.storage.key,n=L(h(e,t)),o=Math.floor(n.length/3),c=y(t);return o==0?n=`${c}${n}`:[3,2,1].forEach(function(s){n=v(n,o*s-1,c[s-1])}),`${u()}${u()}${n}${u()}${u()}`}function w(e,t){let n=2;if(e.length<=9){if(e.slice(2,5)==t)return e.slice(5,-2)}else{let o=Math.floor((e.length-n*2-3)/3),c=`${e[o-1+(1-1)+n]}${e[o*2-1+(2-1)+n]}${e[o*3-1+(3-1)+n]}`;if(e=e.slice(2,-2),t==c)return[3,2,1].forEach(function(s){e=x(e,o*s-1+(s-1))}),e}return!1}function d(e){let t=r.storage.key,n=y(t),o=R(t),c=w(e,n);return c?`${h(F(c),t)} ${o}`:e}function F(e){return e.replaceAll("\u2004","\r").replaceAll("\u2001",`
`).replaceAll("\u2002","\v").replaceAll("\u2003","\f")}function L(e){return r.storage.shorten_text?e.replaceAll("\v","\u2002").replaceAll("\f","\u2003").replaceAll("\r","\u2004").replaceAll(`
`,"\u2001"):e}const b=p.findByProps("sendMessage","receiveMessage"),T=[l.patcher.before("dispatch",l.metro.common.FluxDispatcher,function(e){let[t]=e;switch(t.type){case"MESSAGE_CREATE":return t.message.content=d(t.message.content),[t];case"MESSAGE_UPDATE":return t.message.content=d(t.message.content),[t];case"LOAD_MESSAGES_SUCCESS":return t.messages.forEach(function(n){n.content=d(n.content)}),[t]}r.storage.debug&&l.logger.info(t)}),l.patcher.before("sendMessage",b,function(e){let[,t]=e;r.storage.enable_encryption&&(t.content=$(t.content))}),l.patcher.before("editMessage",b,function(e){let[,t]=e;r.storage.enable_encryption&&(t.content=$(t.content))}),l.patcher.before("startEditMessage",b,function(e){let[,t]=e;r.storage.enable_encryption&&(t=t.replace(D(r.storage.key),""))})];function U(){r.storage.debug&&l.logger.info("Unloading SecretMessage"),T.forEach(function(e){return e()})}const _=C;function D(e){throw new Error("Function not implemented.")}return i.onUnload=U,i.settings=_,i})({},vendetta,vendetta.metro.common,vendetta.ui.components,vendetta.plugin,vendetta.storage,vendetta.metro);
