(function(u,c,o,S,r,m,R,I,g){"use strict";const{FormText:P,FormRow:E,FormInput:$,FormSwitch:f}=S.Forms,{ScrollView:_}=o.ReactNative;function C(){return m.useProxy(r.storage),o.React.createElement(_,null,o.React.createElement($,{title:"Key",value:r.storage.key??"default",onSubmitEditing:function(e){return r.storage.key=e.nativeEvent.text},placeholder:"Secret key to encrypt messages",returnKeyType:"done",secureTextEntry:!0}),o.React.createElement(E,{label:"Auto shorten text",subLabel:"Shorten encrypted text by replacing specific char. Can be detected by AutoMod.",trailing:o.React.createElement(f,{value:r.storage.shorten_text??!0,onValueChange:function(e){return r.storage.shorten_text=e}})}),o.React.createElement(E,{label:"Enable encryption",subLabel:"Messages that you send will be encrypted.",trailing:o.React.createElement(f,{value:r.storage.enable_encryption??!1,onValueChange:function(e){return r.storage.enable_encryption=e}})}),o.React.createElement(E,{label:"Debug Mode",subLabel:"Log debug messages to console.",trailing:o.React.createElement(f,{value:r.storage.debug??!1,onValueChange:function(e){return r.storage.debug=e}})}))}let y="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";function d(e,t){let n="";for(let a=0;a<e.length;a++)n+=String.fromCharCode(e.charCodeAt(a)^t.charCodeAt(a%t.length));return n}function p(e){return`${d("secret",e).slice(0,3).padStart(3,"?")}`}function L(e){return`\`<${e.slice(0,2)}${"*".repeat(Math.max(e.length-2,0))}>\``}function U(e){return new RegExp(` \`<${e.slice(0,2)}${"\\*".repeat(Math.max(e.length-2,0))}>\`$`)}function O(e,t,n){const a=e.slice(0,t),s=e.slice(t);return`${a}${n}${s}`}function B(e,t){const n=e.slice(0,t),a=e.slice(t+1);return`${n}${a}`}function v(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function i(){return y[v(0,y.length-1)]}function N(e){let t=r.storage.key,n=D(d(e,t)),a=Math.floor(n.length/3),s=p(t);return a==0?n=`${s}${n}`:[3,2,1].forEach(function(l){n=O(n,a*l-1,s[l-1])}),`${i()}${i()}${n}${i()}${i()}`}function G(e,t){let n=2;if(e.length<=9){if(e.slice(2,5)==t)return e.slice(5,-2)}else{let a=Math.floor((e.length-n*2-3)/3),s=`${e[a-1+(1-1)+n]}${e[a*2-1+(2-1)+n]}${e[a*3-1+(3-1)+n]}`;if(e=e.slice(2,-2),t==s)return[3,2,1].forEach(function(l){e=B(e,a*l-1+(l-1))}),e}return!1}function b(e){let t=r.storage.key,n=p(t),a=L(t),s=G(e,n);return s?`${d(x(s),t)} ${a}`:e}function x(e){return e.replaceAll("\u2004","\r").replaceAll("\u2001",`
`).replaceAll("\u2002","\v").replaceAll("\u2003","\f")}function D(e){return r.storage.shorten_text?e.replaceAll("\v","\u2002").replaceAll("\f","\u2003").replaceAll("\r","\u2004").replaceAll(`
`,"\u2001"):e}var h;(function(e){e[e.SUB_COMMAND=1]="SUB_COMMAND",e[e.SUB_COMMAND_GROUP=2]="SUB_COMMAND_GROUP",e[e.STRING=3]="STRING",e[e.INTEGER=4]="INTEGER",e[e.BOOLEAN=5]="BOOLEAN",e[e.USER6=6]="USER6",e[e.CHANNEL=7]="CHANNEL",e[e.ROLE=8]="ROLE",e[e.MENTIONABLE=9]="MENTIONABLE",e[e.NUMBER=10]="NUMBER",e[e.ATTACHMENT=11]="ATTACHMENT"})(h||(h={}));var T;(function(e){e[e.BUILT_IN=0]="BUILT_IN",e[e.BUILT_IN_TEXT=1]="BUILT_IN_TEXT",e[e.BUILT_IN_INTEGRATION=2]="BUILT_IN_INTEGRATION",e[e.BOT=3]="BOT",e[e.PLACEHOLDER=4]="PLACEHOLDER"})(T||(T={}));var A;(function(e){e[e.CHAT=1]="CHAT",e[e.USER=2]="USER",e[e.MESSAGE=3]="MESSAGE"})(A||(A={}));const M=R.findByProps("sendMessage","receiveMessage"),w=[c.patcher.before("dispatch",c.metro.common.FluxDispatcher,function(e){let[t]=e;switch(t.type){case"MESSAGE_CREATE":t.message.content=b(t.message.content);break;case"MESSAGE_UPDATE":t.message.content=b(t.message.content);break;case"LOAD_MESSAGES_SUCCESS":t.messages.forEach(function(n){n.content=b(n.content)});break}r.storage.debug&&c.logger.info(t)}),c.patcher.before("sendMessage",M,function(e){let[,t]=e;r.storage.enable_encryption&&(t.content=N(t.content))}),c.patcher.before("editMessage",M,function(e){let[,t]=e;r.storage.enable_encryption&&(t.content=N(t.content))}),c.patcher.before("startEditMessage",M,function(e){let[,,t]=e;t=t.replace(U(r.storage.key),"")}),I.registerCommand({name:"togglesecretmessage",displayName:"togglesecretmessage",description:"Toggle SecretMessage",displayDescription:"Toggle SecretMessage",options:[{name:"enable",displayName:"enable",description:"Enable SecretMessage (If not specified, it will be toggled)",displayDescription:"Enable SecretMessage (If not specified, it will be toggled)",type:h.BOOLEAN,required:!1}],applicationId:"",inputType:T.BUILT_IN_TEXT,type:A.CHAT,execute:function(e,t){e[0].value?(r.storage.enable_encryption=!0,g.toasts.showToast("Encrypting messages enabled")):e[0].value===!1?(r.storage.enable_encryption=!1,g.toasts.showToast("Encrypting messages disabled")):(r.storage.enable_encryption=!r.storage.enable_encryption,g.toasts.showToast(`Encrypting messages ${r.storage.enable_encryption?"enabled":"disabled"}`))}})];function k(){r.storage.debug&&c.logger.info("Unloading SecretMessage"),w.forEach(function(e){return e()})}const H=C;return u.onUnload=k,u.settings=H,u})({},vendetta,vendetta.metro.common,vendetta.ui.components,vendetta.plugin,vendetta.storage,vendetta.metro,vendetta.commands,vendetta.ui);
